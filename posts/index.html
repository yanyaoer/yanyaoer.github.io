<!doctype html><html lang=en-US dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Posts | yányào.com</title>
<link rel=stylesheet href=/css/main.min.8e8195eddcd5aefb03915f2af14e3db65c508a85859da96a19e43823f3c590fd.css integrity="sha256-joGV7dzVrvsDkV8q8U49tlxQioWFnalqGeQ4I/PFkP0=" crossorigin=anonymous></head><body><header><header><a href=https://xn--ynyo-2nad.com/ class=title><h2>yányào.com</h2></a><nav><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/index.xml>RSS</a></nav></header><main><h1>Posts</h1><h2><a href=/posts/poormans-asr/>poorman's ASR solution</a></h2><h2 id=intro>Intro</h2><p>大概20年h2期间，听闻feishu支持了会议自动转译字幕功能，but
当时私有化部署的版本一直没有支持，于是私下找了语音助手团队的同学企图蹭服务用于自动生成会议纪要，<strong>懒即是原动力</strong></p><p>再 but 一下，出于服务成本考量没有蹭成功，后来对应的同学也陆续离职就没下文了</p><p>23年大模型开始各种火热起来，于是借助 openai 的 whisper
在本地陆续写了一些音频转文本的小任务，比如 yt-dlp 下载 bilibili
视频后转音频再转文本，个人习惯上阅读的效率还是高于视频形式的</p><ul><li>[scribe] <a href=https://gist.github.com/yanyaoer/5cc7b0dd6729f306ad3cb740d501cabd>https://gist.github.com/yanyaoer/5cc7b0dd6729f306ad3cb740d501cabd</a></li></ul><p>另外结合语音识别和 LLM 的发散，也试着搓了点语音助手的尝试</p><ul><li>[voice assistant with computer-use] <a href=https://gist.github.com/yanyaoer/752a73d2d6df5a2aa0de179a0f68e8a1>https://gist.github.com/yanyaoer/752a73d2d6df5a2aa0de179a0f68e8a1</a></li><li>[hook for whisper llm-talk] <a href=https://github.com/yanyaoer/whisper.cpp/commit/da85a1b4791e4a7eeb5adb31d47d4c5e53618234>https://github.com/yanyaoer/whisper.cpp/commit/da85a1b4791e4a7eeb5adb31d47d4c5e53618234</a></li></ul><p>但是实时语音识别场景，用 whiper-stream / sense-voice
这类方案还是会有识别不准确、内容丢失的问题存在，调整 step/length
参数效果也不明显，vad 方案延迟也很高&mldr;</p><h2 id=new-solution>New solution</h2><p>上周忽然想起了 kaldi 项目也蛮经典了，于是就试着用 sherpa-[ncnn|onnx] 尝试了下 demo
sherpa-[ncnn|onnx]-microphone
流式识别输出的整体效果已经很接近把音频文件喂给大模型的质量</p><p>于是联系维护者 @csukuangfj
请教怎么提升识别准确率，大佬过于卷周末还给造了新方案和输出优化，甚至还录了 b
站视频 <a href=https://www.bilibili.com/video/BV1xcEMz8EsX/>https://www.bilibili.com/video/BV1xcEMz8EsX/</a></p><iframe src="//player.bilibili.com/player.html?bvid=BV1xcEMz8EsX&page=1" scrolling=no autoplay border=0 frameborder=no framespacing=0 allowfullscreen></iframe><ul><li>[Add real-time speech recognition example for SenseVoice. (#2197)] <a href=https://github.com/k2-fsa/sherpa-onnx/commit/53518efd2fe70f49b86f180a4e5b49fdc374da82>https://github.com/k2-fsa/sherpa-onnx/commit/53518efd2fe70f49b86f180a4e5b49fdc374da82</a></li><li>[Fix displaying streaming speech recognition results for Python. (#2196)] <a href=https://github.com/k2-fsa/sherpa-onnx/commit/4a833a754743076d68252731c681511e2d9390bd>https://github.com/k2-fsa/sherpa-onnx/commit/4a833a754743076d68252731c681511e2d9390bd</a></li></ul><p>另外也体验到 two-pass 双模型识别的效果，两种方式都能满足俺的使用场景🎉</p><h2><a href=/posts/pandoc-md2pdf/>Pandoc generate pdf from markdown</a></h2><h2 id=intro>Intro</h2><p>始终不太习惯 word/wps 类工具编辑文本，再一次尝试用 <code>pandoc</code> 来生成 pdf，算是初步搞明白一点玩法，本文略过 markdown 的部分主要记录 <code>latex</code> 相关设定内容。</p><ul><li><code>wkhtmltopdf</code> 也是一个选项，但是转 HTML 再生成 pdf 就没啥挑战了额哈哈</li></ul><h2 id=setup>Setup</h2><p>首先完整安装 latex 包</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ brew uninstall --cask basictex
</span></span><span style=display:flex><span>$ brew install --cask mactex
</span></span></code></pre></div><h2 id=latex-template>Latex template</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>title</span>: <span style=color:#e6db74>&#34;Your article title here&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>date</span>: <span style=color:#e6db74>2023-02-20</span>
</span></span><span style=display:flex><span><span style=color:#f92672>fontsize</span>: <span style=color:#ae81ff>12pt</span>
</span></span><span style=display:flex><span><span style=color:#75715e># fc-list :lang=zh</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#mainfont: &#34;PingFang SC&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mainfont</span>: <span style=color:#e6db74>&#34;Sarasa Mono SC&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># monofont: &#34;FantasqueSansM Nerd Font Mono&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>monofont</span>: <span style=color:#e6db74>&#34;Sarasa Mono SC&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 中文换行支持</span>
</span></span><span style=display:flex><span><span style=color:#f92672>lang</span>: <span style=color:#ae81ff>zh-CN</span>
</span></span><span style=display:flex><span><span style=color:#f92672>geometry</span>: <span style=color:#ae81ff>margin=2cm</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置双栏</span>
</span></span><span style=display:flex><span><span style=color:#75715e># classoption=twocolumn</span>
</span></span><span style=display:flex><span>---
</span></span></code></pre></div><p>在 markdown 文档的最前面加入以上 metadata 简化命令参数设定，实际效果等价于</p><h2><a href=/posts/flair-58/>Flair-58 Espresso Maker</a></h2><h2 id=flair-58>flair-58</h2><p><a href=https://flairespresso.com/product/flair-58/>https://flairespresso.com/product/flair-58/</a></p><p><img src=/flair-coffee.jpg alt></p><p>周末浪费了2天豆子，终于折腾出比较理想的设定</p><ul><li>预热：浅烘 = 3档，中烘 = 2档，深烘 = 1档</li><li>磨豆：C40 调到 8 格(浅烘豆 +=1)</li></ul><p>奶泡机没到位，先用娃的小奶锅煮 200ml Oatly 燕麦奶，稍热就好，没有打出泡沫也就无所谓拉花了<br>PlanB: 微波炉加热 + <a href=https://www.ikea.cn/cn/zh/p/produkt-pu-luo-da-da-mo-qi-hei-se-70301165/>宜家 ¥9.9 手持奶泡器</a></p><p>我买的优化后版本默认配无底手柄 + 58mm 18g粉碗，而上半年批次的好像是 20g粉碗，底部没有凹弧线，然后分水网和冲煮头是一体的，每杯都得拆下来清理，现在只需要拆手柄洗洗粉碗和分水网就好，方便连续出杯(但是对于没有多个手柄和粉碗的初阶用户来说，重新填粉加水的操作并不连续 -.-)<br>群里有大佬<a href="https://docs.google.com/document/d/1szvhjTE2F7lzhr38phggVUO50fkbddq0/edit?usp=sharing&amp;ouid=115932911354635105266&amp;rtpof=true&amp;sd=true">改装了底座和支架的方案</a>，解决下压前倾问题和使用12cm+的秤</p><p>而无底手柄安装还不太熟练，经常要弯腰低头去看小翅膀有没有卡到位，然后注水再安装压力表(顺便当预浸泡)，18g豆出 36g液体，如果粉磨得过细，下压会很费劲</p><p>虽然目前 5-9bar 之间压的曲线还不太稳定，偶尔通道也不太顺滋到杯外，但是香浓的 crema 已然远超预期(其实很容易过萃，但是家属喝不出来😂)</p><p>试了下用冰的屈臣氏做 coffee soda，难喝🤢</p><p>好多想买的配件：拉花奶缸、粉锤、布粉器、鼠尾粉碗、粉饼垃圾盒</p><p><strong>update: 2022-08-19 14:09:08</strong></p><p>买了新的拉花缸和称，但是懒到完全不想碰牛奶，only pure coffee and water&mldr;</p><p>早晨的冲煮开始逐渐暴躁，直接磨58g粉分3次装填、下压、出液到一个杯里，再加冰块分装成两份 long black 出门，少洗两次杯子动作也更流畅～大概15-20分钟完成</p><h2><a href=/posts/toy/>剁手好物推荐</a></h2><ul><li>Insta360 GO2 拇指运动相机</li><li>巷贩小酒 - 东方甄选金酒</li><li>Reebok royal techque 板鞋</li><li>ALTRA Escalante 2.5 轻量零落差跑鞋</li><li>SENNHEISER IE300 耳机</li><li>PhD 能量棒</li></ul><h2><a href=/posts/volvo-v60/>Volvo v60</a></h2><p>因为家庭新成员加入，所以买车的优先级提了上来。一开始考虑大尺寸6/7座suv，能装全家人短途出行，比如highlander, outlander, explorer, Pajero&mldr;后来因为今年各种新款上市，到最终提车时间有点晚，再加上城市拥堵和停车问题，回归到最初的选项也是一直种草的旅行车Volvo v60</p><p>中间还去看过Jaguar和Alfa Romeo，可惜后排空间有点小，对外型内饰非常满意，动力和操控也很可以，尤其Julie的前脸颜值太命中我了，一直对mx5这类笑脸无法抗拒…</p><p>V60在4s店试驾的豪华版，刚开始还挺不适应转向手感和油门刹车的，感觉都很沉很重。比起来以前开过的各种小钢炮和家用轿车，沉着有余灵活不够，前期不熟悉的时候操作起来都得小心翼翼。</p><p>最后订车选了致远焰影蓝运动款，因为厂家直销的关系也没讲价，就跟销售要了行车记录仪和儿童座椅。目前开两个月小一千公里的行程，大概总结些点吧</p><ul><li>外观线条比例，审美观因人而异，但是V60各处都在我的区间内</li><li>nappa皮座椅舒适和支撑都很到位，前排有可调的腿拖和腰撑。对豪华版的实木装饰水晶档杆其实没啥需求，氛围灯也蛮简约，没有那么夜店风。可惜选配的交车时间太长，不然座椅通风、冬季包、米色内饰都想加</li><li>后排空间坐两人还行，但是中间的地台太高，不适合长途5人出行</li><li>后备箱就不用夸了，狗子的航空箱一直塞在里面，出去玩很方便，去宜家就把后座放平。6月份搬家就跑了两趟，上次搬家借老王的a3可拉了56趟</li><li>48v电机+autohold，起步平顺没有纯燃油车型起步轰发动机那个颤抖</li><li>低转油门动力响应略有延迟，升档不算很迅速，不过相比起golf，508要好很多</li><li>油耗市区日常11升百公里，跑机场高速能到6.1左右，平时一个月加一次满箱油，推荐95号</li><li>方向盘虚位明显，过弯会习惯性多打一些位置，转向比hatchback车型都要重许多。前脸两侧的存在感明显，低坐姿的时候会开得谨慎，反而不会觉得屁股有什么阻碍</li><li>底盘确实在开过的车里算得上优秀，过弯和滤震都很扎实。静音实属一般，风噪胎噪在后排(或者车速超过100)尤其明显，所以也就不考虑顶上行李箱</li><li>autopilot 模式在跑高速时非常愉悦，车道保持比我打方向顺滑多了，跟前车保持车距也很可靠，另外养成了并线前一定先打灯的习惯，否则车子会自己修正。能称为瑕疵的就是自动刹车不够线性，乘客会有明显的拉扯感甚至点头；拥堵路段还得切回手动模式，跟车距离在我这边太容易被加塞</li></ul><h2><a href=/posts/self-host-maddy-mail-server/>Self Host Maddy Mail Server</a></h2><h2 id=maddy>maddy</h2><blockquote><p>Composable all-in-one mail server. <a href=https://github.com/foxcpp/maddy>https://github.com/foxcpp/maddy</a></p></blockquote><p>准备自建系列服务替换掉 google 全家桶，先试了传统的 Postfix, Dovecot, OpenDKIM, OpenSPF, OpenDMARC 套餐，但是本人水平菜，机器配置也不高，折腾两天还没跑起来，正好看到订阅的 changelog 推荐了 maddy <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> 于是搓搓手气试试这个邮局方案，以下是满足个人喜好的优点</p><ul><li>基于 golang 生态依赖少，方便打镜像</li><li>验证数据存在 sqlite 里也很轻量</li><li>没有 web 端，只需要 imap + thunderbird 即可</li><li>配置文件相对简单</li></ul><h2 id=install>install</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /data/maddy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># hard link caddy&#39;s crt and key to maddy</span>
</span></span><span style=display:flex><span>ln var/lib/caddy/.local/share/caddy/certificates/acme-v02.api.letsencrypt.org-directory/<span style=color:#e6db74>${</span>domain<span style=color:#e6db74>}</span>/<span style=color:#e6db74>${</span>domain<span style=color:#e6db74>}</span>.crt /data/maddy/<span style=color:#e6db74>${</span>domain<span style=color:#e6db74>}</span>.crt
</span></span><span style=display:flex><span>ln var/lib/caddy/.local/share/caddy/certificates/acme-v02.api.letsencrypt.org-directory/<span style=color:#e6db74>${</span>domain<span style=color:#e6db74>}</span>/<span style=color:#e6db74>${</span>domain<span style=color:#e6db74>}</span>.key /data/maddy/<span style=color:#e6db74>${</span>domain<span style=color:#e6db74>}</span>.key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># foxcpp/maddy:v0.4.2</span>
</span></span><span style=display:flex><span>podman run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name maddy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /data/maddy:/data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 25:25 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 143:143 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 587:587 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 993:993 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 465:465 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  yanyaoer/maddy:master
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># add user</span>
</span></span><span style=display:flex><span>podman run --rm -it -v /data/maddy:/data --entrypoint /bin/maddyctl yanyaoer/maddy:master creds create yanyao@mail.yadanhe.com
</span></span></code></pre></div><p>参考文档配置<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> 完后发送邮件对方可收，本地 thunderbird 接收回复邮件时有问题</p><h2><a href=/posts/utteranc-comments/>Utteranc Comments</a></h2><p>utterances - A lightweight comments widget built on GitHub issues. Use GitHub issues for blog comments, wiki pages and more!</p><h2 id=install>install</h2><ol><li><p>install <a href=https://github.com/apps/utterances>utterances</a> on your repo</p></li><li><p>add the script to your template</p></li></ol><pre tabindex=0><code>&lt;script src=&#34;https://utteranc.es/client.js&#34;
        repo=&#34;[ENTER REPO HERE]&#34;
        issue-term=&#34;pathname&#34;
        theme=&#34;github-light&#34;
        crossorigin=&#34;anonymous&#34;
        async&gt;
&lt;/script&gt;
</code></pre><p>for exsamples <a href=https://github.com/yanyaoer/yanyaoer.github.io/commit/f2508ce7557d372f909f68ee32371f86895fd92f>https://github.com/yanyaoer/yanyaoer.github.io/commit/f2508ce7557d372f909f68ee32371f86895fd92f</a></p><p>done.</p><h2><a href=/posts/zotero/>Zotero as personal knowledge management</a></h2><p><a href=https://www.zotero.org/>Zotero</a> 常用于科研的文献管理，由 firefox 浏览器插件发展到现在有了独立的桌面和<a href=https://github.com/mickstar/Zoo-For-Zotero>移动客户端</a>。</p><p><img src=/zotero.png alt></p><ul><li>本身具备简易的 rss 订阅功能可以用来追踪论文的更新</li><li>注册在线账户后支持导出资料库给其他同学订阅</li><li>浏览器插件 <a href=https://github.com/zotero/zotero-connectors>zotero connectors</a> 则类似各类笔记应用的 web clipper，方便导入各种资料。<strong>注意科学上网加载完整页面后再进行保存</strong></li><li>通过插件可以扩展出许多其他功能，比如文件同步、高级档案管理</li></ul><h2 id=quickstart>quickstart</h2><pre tabindex=0><code>brew cask install zotero
</code></pre><p>这里简单用 <a href=https://github.com/yanyaoer/caddy2-webdav>caddy2 搭建 webdav</a> 来同步附件，就没用高级的 <a href=http://zotfile.com/>zotfile</a></p><p>至于自带的笔记功能怎么说呢～ 已经适应不能这种风格了</p><table><thead><tr><th>add-ons</th><th>link</th></tr></thead><tbody><tr><td>quicklook</td><td><a href=https://github.com/mronkko/ZoteroQuickLook/releases>https://github.com/mronkko/ZoteroQuickLook/releases</a></td></tr><tr><td>markdown</td><td><a href=https://addons.thunderbird.net/zh-cn/thunderbird/addon/markdown-here-xul/>https://addons.thunderbird.net/zh-cn/thunderbird/addon/markdown-here-xul/</a></td></tr></tbody></table><h2 id=subscription>subscription</h2><ul><li><p><a href=https://arxiv.org/list/cs/recent>https://arxiv.org/list/cs/recent</a>
康奈尔大学提供的免费论文预览平台，主要订阅 cs.SD 音频相关更新</p></li><li><p><a href=https://scholar.google.com/>https://scholar.google.com/</a></p></li><li><p><a href=https://academic.microsoft.com/>https://academic.microsoft.com/</a>
谷歌学术、微软学术也可以用来搜索一些关键词并订阅推送</p></li><li><p><a href=https://www.storkapp.me/>https://www.storkapp.me/</a> 提供关键词订阅推送到邮箱</p></li><li><p><a href=https://sci-hub.tw/>https://sci-hub.tw/</a> 实在找不到的下载就靠毛子的共享服务</p></li></ul><p>将码农常用的文档工具 gitbook 转为 pdf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew cask install calibre
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo npm install -g gitbook-cli
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gitbook install  <span style=color:#75715e># for gitbook plugin</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>git clone https://github.com/prometheus/docs.git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gitbook pdf
</span></span></code></pre></div><p>ps: gitbook 开源版本已经很久不维护了，可以换到 <a href=https://github.com/honkit/honkit>honkit</a> fork 的版本</p><h2><a href=/posts/rss2email/>Rss2email</a></h2><p>距离上次从 <a href=https://blogtrottr.com>https://blogtrottr.com</a> 迁移 rss 订阅到 feedly 差不多五六年了，
这会网络不可用的状况又变得严重些，干脆还是用自建服务来接收感兴趣的内容，
当然备选方案也不少:</p><ul><li><a href=https://github.com/miniflux/miniflux>https://github.com/miniflux/miniflux</a></li><li><a href=https://github.com/SSilence/selfoss>https://github.com/SSilence/selfoss</a></li><li><a href=https://github.com/FreshRSS/FreshRSS>https://github.com/FreshRSS/FreshRSS</a></li><li><a href=https://git.tt-rss.org/fox/tt-rss>https://git.tt-rss.org/fox/tt-rss</a></li></ul><p>出于复古心理顺便减少对应的 app 安装选择问题，又选择了回归 email 方式订阅更新</p><h2 id=安装配置>安装配置</h2><p>rss2email 的安装到简单，参考 <a href=https://github.com/rss2email/rss2email>官方文档</a>
直接 <code>apt install rss2email</code>，默认配置会发送文本邮件，修改 <code>html-mail=True</code>，
在我的环境里 smtp over sendgrid 很容易超配额，sendmail 基本发送不出去，
就配上 imap.google 账户自己发给自己啦～</p><p>从 feedly 导出 opml 文件然后 <code>r2e opmlimport</code> 完事大吉</p><p>需要注意的是，在 <code>r2e run</code> 的执行过程中对配置文件进行修改非常容易被覆盖 <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>，不要同时搞太多操作就好，</p><p><strong>update: 2020-09-18 17:34:49</strong></p><p>修改参数 <code>force-from = True</code>，默认会从 feed 里优先提取作者或者发布站点的邮箱，导致 gmail 过滤器失败</p><h2 id=定时任务>定时任务</h2><p>现代 linux 发行版本(比如这里用的 ubuntu 20.04)，默认不带 cronjob 服务，改为 systemd 来管理各种服务，定时任务的写法稍微麻烦了些，先用当前 user 权限来 <code>$HOME/.config/systemd/user</code> 写入定时任务配置</p><h2><a href=/posts/bitwarden_rs_with_podman/>Deploy bitwarden_rs with podman</a></h2><p>bitwarden_rs<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> 是个用 rust/rocket 编写的非官方 api 实现，
<a href=https://github.com/bitwarden/server>dotnet</a> 版本有点儿不太适合手头的部署环境</p><p>这里用比较现代的 podman<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> 来运行 docker 服务</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>podman run -d --name bitwarden -v /bw-data/:/data/:Z -e ROCKET_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span> -p 8080:8080 bitwardenrs/server:latest
</span></span><span style=display:flex><span>podman generate systemd --name bitwarden --files
</span></span><span style=display:flex><span>mv container-bitwarden.service /etc/systemd/system/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>systemctl --user enable /etc/systemd/system/container-bitwarden.service
</span></span><span style=display:flex><span>systemctl --user start container-bitwarden.service
</span></span></code></pre></div><p>然后用 nginx 或者 caddy 代理一下 8080 端口即可连接客户端</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install bitwarden-cli  <span style=color:#75715e># npm install -g @bitwarden/cli</span>
</span></span><span style=display:flex><span>bw config server https://bw.myserver.com
</span></span></code></pre></div><p><strong>update 2021-04-01</strong> build bitwaden_rs from source</p><pre tabindex=0><code># install rust
apt install git make gcc libssl-dev pkg-config curl
curl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env

# build bitwarden_rs
git clone https://github.com/dani-garcia/bitwarden_rs/
cd bitwarden_rs/
cargo build --features sqlite --release
cp target/release/bitwarden_rs /usr/local/bin/

# download bw_web_vault from https://github.com/dani-garcia/bw_web_builds/releases
</code></pre><p>edit /etc/systemd/system/bitwarden.service</p><h2><a href=/posts/minio-storage-service/>Minio Storage Service</a></h2><p><a href=https://min.io>min.io</a> 来自前 glusterFS 团队的分布式存储项目，
兼容 aws s3 / google cloud storage 接口，支持多磁盘、多节点，伸缩扩容方便，
golang 编写+单执行文件部署，非常适合用 k8s 编排复制来搭建私有对象存储服务</p><p><strong>没有生产环境的使用经验，以下仅用于业余尝鲜</strong> <del>六一节礼物</del></p><h2 id=gnulinux-下载安装>GNU/Linux 下载安装</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://dl.min.io/server/minio/release/linux-amd64/minio -O /usr/local/bin/minio
</span></span><span style=display:flex><span>chmod +x /user/local/bin/minio
</span></span></code></pre></div><h2 id=添加用户组和配置文件>添加用户、组和配置文件</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>groupadd --system minio
</span></span><span style=display:flex><span>useradd --system --gid minio --shell /usr/sbin/nologin --comment <span style=color:#e6db74>&#34;Minio file server&#34;</span> minio
</span></span><span style=display:flex><span>mkdir -p /data/minio
</span></span><span style=display:flex><span>chown -R minio:minio /data/minio
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># replace minio.service with your own config, eg. User,Group</span>
</span></span><span style=display:flex><span>wget https://raw.githubusercontent.com/minio/minio-service/master/linux-systemd/minio.service -O /etc/systemd/system/minio.service
</span></span></code></pre></div><h2 id=配置端口和密钥>配置端口和密钥</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># optional. run `uuidgen` to creates AK/SK</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt;&gt; /tmp/minio
</span></span></span><span style=display:flex><span><span style=color:#e6db74>MINIO_VOLUMES=&#34;/data/minio/&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>MINIO_OPTS=&#34;--address :9199&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>MINIO_ACCESS_KEY=`uuidgen`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>MINIO_SECRET_KEY=`uuidgen`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h2 id=启动服务>启动服务</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl enable minio.service
</span></span><span style=display:flex><span>systemctl start minio.service
</span></span></code></pre></div><p><a href=https://docs.min.io/docs/minio-client-complete-guide.html>客户端 mc</a>
使用说明参考官方文档好了，和 s3 命令行也没太多区别，
甚至可以用来做 gcs/s3 代理用</p><h2><a href=/posts/pour-over-coffee-makers/>Pour Over Coffee Makers</a></h2><h2 id=办公室日常用品>办公室日常用品</h2><ul><li>hario v60 2人份玻璃滤杯 <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></li><li>hario v60 600ml 云朵分享壶 <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></li><li>comandante c40 手摇磨豆机 <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></li><li>kalita 700ml 细嘴壶 <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></li><li>rivers seek 随手杯 <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></li></ul><hr><ul><li><p>2020-0615 新购入 Mr.clever 聪明杯 <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></p></li><li><p>2020-0622 新购入 hario drip kettle air <sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>，
用了两次手感偏轻水流控制得不稳 T_T</p></li><li><p>2020-1027 新购入 fellow ode 电动磨豆机 <sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup></p></li><li><p>2020-1109 新购入 fellow stagg ekg 温控壶 <sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup></p></li><li><p>2023-half 新购入 hoop 澡盆滤杯 <sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup>，类似聪明杯但会拉长萃取时间</p></li></ul><p>每天一早 <del>中午</del> 到公司开始烧水，然后吭呲吭呲摇 40g 豆子兑 600ml 左右的水</p><p>手法就比较 <del>随意</del> 业余啦，主要参考下面两个视频，出品大概率自己都还挺喜欢的
<strong>按比例加注水量翻倍</strong></p><h3 id=46-method-by-tetsu-kasuya>&ldquo;4:6 method&rdquo; by Tetsu Kasuya <sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup></h3><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/wmCW8xSWGZY?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><h3 id=the-ultimate-v60-technique-by-james-hoffmann>&ldquo;The Ultimate V60 Technique&rdquo; by James Hoffmann</h3><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/AI4ynXzkSQo?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><h2 id=家庭版>家庭版</h2><ul><li>baratza encore 电动磨豆器 <sup id=fnref:12><a href=#fn:12 class=footnote-ref role=doc-noteref>12</a></sup></li><li>kinto OCT 2人份陶瓷滤杯 <sup id=fnref:13><a href=#fn:13 class=footnote-ref role=doc-noteref>13</a></sup></li><li>ikea vardagen 500ml 玻璃量杯 <sup id=fnref:14><a href=#fn:14 class=footnote-ref role=doc-noteref>14</a></sup></li><li>muji 万古烧马克杯 <sup id=fnref:15><a href=#fn:15 class=footnote-ref role=doc-noteref>15</a></sup></li></ul><hr><ul><li>2020-0615 新购入 hario filter-in 冷萃瓶 <del>已碎</del>，21年夏再次购入 <sup id=fnref:16><a href=#fn:16 class=footnote-ref role=doc-noteref>16</a></sup></li></ul><p>刚开始的时候装备上交了不少学费，比如：<del>电动砍豆机</del>、<del>廉价手磨</del>、<del>aeropress</del>，
虽然不能一概而论，实际上很大程度还是遵循一分钱一分货的原则，性能越好则价格呈指数上涨
条件允许的话尽量选择好一点的设备，毕竟也是天天要用的家伙事</p><h2><a href=/posts/mastodon/>Mastodon</a></h2><p><code>Mastodon 长毛象</code><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> &ndash; 基于 rubyonrails/reactjs/nodejs 开发的分布式 &
去中心化 twiter clone。利用空闲时间在 aws lightsail 上开了个实例把服务跑了起来</p><p>一开始走了些弯路，因为选机房和省钱的缘故，重建了若干次操作系统，最后的选择是
tokyo+cloudflare，没错我又套了 cdn，实在是海外线路到北京联通不稳定</p><p>安装步骤没有使用 docker 而是参考文档从源码安装<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>，原因和解决方案如下：</p><ul><li><p><del>机器用 $3.5/mo 512mem 最便宜的那档消费降级</del>(512M 内存重启会拉垮弱鸡，服务已迁移到 oraclecloud)，出于 net/io 性能考虑就不使 docker 啦</p></li><li><p>内存问题，<code>RAILS_ENV=production bundle exec rake mastodon:setup</code>
这一步骤执行到 <code>rails assets:precompile</code>，
不管是在 docker 里跑还是直接运行都会报 swap 分区不足，找到两个方案来解决:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># create swapfile &lt;https://linuxize.com/post/create-a-linux-swap-file/&gt;</span>
</span></span><span style=display:flex><span>$ sudo fallocate -l 2G /swapfile
</span></span><span style=display:flex><span>$ sudo chmod <span style=color:#ae81ff>600</span> /swapfile
</span></span><span style=display:flex><span>$ sudo mkswap /swapfile
</span></span><span style=display:flex><span>$ sudo swapon /swapfile
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># verify active</span>
</span></span><span style=display:flex><span>$ sudo swapon --show
</span></span><span style=display:flex><span><span style=color:#75715e># optional: low value is better for production</span>
</span></span><span style=display:flex><span>$ sudo sysctl vm.swappiness<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span></code></pre></div><h2 id=邮件配置>邮件配置</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># By default the memory limit in Node. js is 512 mb, </span>
</span></span><span style=display:flex><span><span style=color:#75715e># use command —- max-old-space-size to increase the memory limit</span>
</span></span><span style=display:flex><span>$ NODE_OPTIONS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--max-old-space-size=4096&#34;</span> RAILS_ENV<span style=color:#f92672>=</span>production bundle exec rails assets:precompile
</span></span></code></pre></div><p>直接配置 localhost 发送邮件无效，先用 <a href=https://sendgrid.com/>sendgrid</a> 免费版顶着, 一天 100 封邮件目前够用</p><h2><a href=/posts/gitlab-repo/>Gitlab Repo</a></h2><p>gitlab 里面已经有十来个 group，几百个 project，虽然不一定会每个项目都参与，
但是为了快速同步代码，又捡起了 android 开发常用的 repo 命令来管理多项目代码。
这里使用了 gitlab graphql 接口来遍历项目生成分组的 manifest 文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> argparse
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> urllib2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GITLAB_HOST <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;gitlab.mydomain.com&#34;</span>
</span></span><span style=display:flex><span>GITLAB_SSH_URL <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ssh://git@&#34;</span> <span style=color:#f92672>+</span> GITLAB_HOST
</span></span><span style=display:flex><span>GITLAB_GRAPHQL_URL <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://&#34;</span> <span style=color:#f92672>+</span> GITLAB_HOST <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/api/graphql&#34;</span>
</span></span><span style=display:flex><span>GITLAB_TOKEN <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>GITLAB_GROUP <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;&#34;</span>]
</span></span><span style=display:flex><span>BLACK_LIST <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#34;&#34;</span>,)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 以上配置修改为自己的设定</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>template <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;!-- autogen by gen.py, do not edit this file --&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;manifest&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;remote  name=&#34;origin&#34; fetch=&#34;</span><span style=color:#e6db74>{ssh_url}</span><span style=color:#e6db74>&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;default revision=&#34;master&#34; remote=&#34;origin&#34; sync-c=&#34;true&#34; sync-j=&#34;4&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>{content}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/manifest&gt;&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write_file</span>(content, filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;default.xml&#34;</span>):
</span></span><span style=display:flex><span>    _file <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>dirname(__file__), filename)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(_file, <span style=color:#e6db74>&#34;w&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        f<span style=color:#f92672>.</span>write(template<span style=color:#f92672>.</span>format(content<span style=color:#f92672>=</span>content, ssh_url<span style=color:#f92672>=</span>GITLAB_SSH_URL))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>fetch_project_of_group</span>(group, write<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>):
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;{ group(fullPath: &#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;) { projects { nodes { fullPath } } }}&#39;</span> <span style=color:#f92672>%</span> group
</span></span><span style=display:flex><span>    req <span style=color:#f92672>=</span> urllib2<span style=color:#f92672>.</span>Request(
</span></span><span style=display:flex><span>        GITLAB_GRAPHQL_URL,
</span></span><span style=display:flex><span>        data<span style=color:#f92672>=</span>json<span style=color:#f92672>.</span>dumps(dict(query<span style=color:#f92672>=</span>data)),
</span></span><span style=display:flex><span>        headers<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;Authorization&#34;</span>: <span style=color:#e6db74>&#34;Bearer &#34;</span> <span style=color:#f92672>+</span> GITLAB_TOKEN,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;Content-Type&#34;</span>: <span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    resp <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>load(urllib2<span style=color:#f92672>.</span>urlopen(req))
</span></span><span style=display:flex><span>    content <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>join(
</span></span><span style=display:flex><span>        [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;&lt;project path=&#34;</span><span style=color:#e6db74>{d}</span><span style=color:#e6db74>&#34; name=&#34;</span><span style=color:#e6db74>{d}</span><span style=color:#e6db74>&#34;/&gt;&#39;</span><span style=color:#f92672>.</span>format(d<span style=color:#f92672>=</span>p[<span style=color:#e6db74>&#34;fullPath&#34;</span>])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> p <span style=color:#f92672>in</span> resp[<span style=color:#e6db74>&#34;data&#34;</span>][<span style=color:#e6db74>&#34;group&#34;</span>][<span style=color:#e6db74>&#34;projects&#34;</span>][<span style=color:#e6db74>&#34;nodes&#34;</span>]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> p[<span style=color:#e6db74>&#34;fullPath&#34;</span>] <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> BLACK_LIST
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> write:
</span></span><span style=display:flex><span>        write_file(content, filename<span style=color:#f92672>=</span>group<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#e6db74>&#34;-&#34;</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;-group.xml&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> content
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    parser <span style=color:#f92672>=</span> argparse<span style=color:#f92672>.</span>ArgumentParser(description<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Process some projects.&#34;</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;-G&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;--group&#34;</span>,
</span></span><span style=display:flex><span>        help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;for group/subgroup or all&#34;</span>,
</span></span><span style=display:flex><span>        type<span style=color:#f92672>=</span>str,
</span></span><span style=display:flex><span>        choices<span style=color:#f92672>=</span>ns <span style=color:#f92672>+</span> [<span style=color:#e6db74>&#34;all&#34;</span>, <span style=color:#e6db74>&#34;default&#34;</span>],
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    arg <span style=color:#f92672>=</span> parser<span style=color:#f92672>.</span>parse_args()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> arg<span style=color:#f92672>.</span>group <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;all&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> GITLAB_GROUP:
</span></span><span style=display:flex><span>            fetch_project_of_group(x)
</span></span><span style=display:flex><span>        d <span style=color:#f92672>=</span> [fetch_project_of_group(x, write<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>) <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> GITLAB_GROUP]
</span></span><span style=display:flex><span>        write_file(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>join(d))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> arg<span style=color:#f92672>.</span>group <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;default&#34;</span>:
</span></span><span style=display:flex><span>        d <span style=color:#f92672>=</span> [fetch_project_of_group(x, write<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>) <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> GITLAB_GROUP]
</span></span><span style=display:flex><span>        write_file(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>join(d))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        fetch_project_of_group(arg<span style=color:#f92672>.</span>group)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><p><strong>USAGE:</strong> 创建完 manifest 文件之后提交到仓库就可以愉快的玩耍啦</p><h2><a href=/posts/dash-replacement/>Dash Replacement with tmux</a></h2><p>通过 tmux 快捷集成替换 dash.app 查询开发文档</p><pre tabindex=0><code>$ brew install dasht

$ dasht-docsets | tr &#39;A-Z&#39; &#39;a-z&#39;
go
javascript
python_3
rust
tornado
</code></pre><pre tabindex=0><code># tmux.conf quick start
bind -n S-up command-prompt -p &#39;docset:&#39; &#34;splitw -h -fb -l 80 dasht &#39;%%&#39;&#34;
</code></pre><h2><a href=/posts/cloudflare-gost/>Cloudflare Gost</a></h2><p>从清明节开始，稳定运行好几年的 ss 服务器终于阵亡了，所有端口全挂。一直蹭公司的 vpn 查资料也挺到了五一，实在拖延够够的就再另外开了一台机器中转过去迁移数据，不过嘛年纪大了又开始犯懒，企图拯救获得资格认证的机器，通过一番网上冲浪学习到了目前(实测可用)能满足我需求的方案。简单来说就是：cloudflare[后文简称为 cf] + websockets over gost，实际的客户端通过 cdn 代理再接入服务</p><p>有几个需要注意的地方：</p><ul><li><p>gost 启动时绑定的 localhost 不直接对外访问，走了 caddy 的转发，而这一步和 cf 的 ssl 证书配置会造成不停的重定向跳转，需要将 cf 加密模式配置为 flexible</p></li><li><p>然后修改 caddy 的域名配置为 <a href=http://domain.com>http://domain.com</a> <a href=https://domain.com>https://domain.com</a> { &mldr; } 阻止 cf 和 caddy 之间的 http -> https</p></li><li><p>gost 服务端监听 ws 协议，本地的 gost 客户端转发 wss 协议连接 cf_domain:443</p></li><li><p>需要鉴权的方案使用 socks5+wss://username:password@domain:port</p></li><li><p>android 客户端的设置，因为使用了 ws 协议，所以需要将域名写入到插件的配置里，直接用域名变量无法解析</p></li></ul><p>具体配置参考官方文档，<strong>一切浪费的时间都是源于没认真仔细看文档</strong></p><ul><li><a href=https://github.com/haoel/haoel.github.io>https://github.com/haoel/haoel.github.io</a></li><li><a href=https://github.com/ginuerzh/gost>https://github.com/ginuerzh/gost</a></li><li><a href=https://github.com/xausky/ShadowsocksGostPlugin>https://github.com/xausky/ShadowsocksGostPlugin</a></li></ul><p><strong>update 2021-03-01</strong> 由于 shawdowsocks 的 android 客户端升级导致插件不可用，另外部署了 <a href=https://github.com/txthinking/brook>brook</a> wsserver 给手机使用</p><h2><a href=/posts/webpack-resolve-local-module/>webpack resolve local module</a></h2><p>最近的项目刚开始，设计的目录层级有点深<br>经常会在好几层本地路径之间互相引用</p><p><code>import Image from '../../../../components/image'</code></p><p>这层层叠叠的路径写起来实在丑陋<br>不由得想起 Python 从项目根目录引用模块<br>然后研究了一下 Node.js 里的几种简易实现</p><p>干脆利落的软连接: <code>ln -s node_modules src</code></p><p>修改环境变量: <code>NODE_PATH=. node app</code></p><p>从本地目录安装:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// package.json 
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 需要运行 npm install
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>{
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;baz&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;dependencies&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;foo&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;file: ./src&#34;</span>,
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>另外还有些修改 global，或者引入其他 require 实现的方法就不再一一列出了<br>最终选择的是修改 webpack 配置</p><pre tabindex=0><code>// webpack.config.js
resolve: {
  modulesDirectories: [__dirname, &#39;node_modules&#39;],
}
</code></pre><p><a href=https://gist.github.com/branneman/8048520>https://gist.github.com/branneman/8048520</a>
<a href=http://stackoverflow.com/questions/10860244/how-to-make-the-require-in-node-js-to-be-always-relative-to-the-root-folder-of-t/41078266#41078266>http://stackoverflow.com/questions/10860244/how-to-make-the-require-in-node-js-to-be-always-relative-to-the-root-folder-of-t/41078266#41078266</a>
<a href=https://webpack.github.io/docs/configuration.html#resolve-modulesdirectories>https://webpack.github.io/docs/configuration.html#resolve-modulesdirectories</a></p><h2><a href=/posts/leonard-cohen-you-want-it-darker/>Leonard Cohen - you want it darker</a></h2><h2 id=年度最佳>年度最佳</h2><p><a href=https://open.spotify.com/album/3jeTB3j3QmUs8SPIVleHtU><img src=images/you-want-it-darker.jpg alt="you want it darker"></a></p><p><a href=https://open.spotify.com/album/3jeTB3j3QmUs8SPIVleHtU>you want it darker</a></p><p>循环听了好几天</p><p>干净低沉的嗓音加配乐</p><p>愈发担心以后听不到了怎么办 😢～</p><h2><a href=/posts/web-audio/>web audio</a></h2><p>照文档撸了一下 AudioContext 可视化音频<br>桌面浏览器上 Safari 9, Chrome stable 绘制正常<br>移动端只有微信的 webview 能工作, 纯玩票叻
<img src=https://mdn.mozillademos.org/files/7977/wave.png alt=wave></p><p>ref:
<a href=https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API>https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;viewport&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width=device-width, user-scalable=no&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;AV&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>canvas</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vis&#34;</span>&gt;&lt;/<span style=color:#f92672>canvas</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>audio</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;av&#34;</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;YOUR_AUDIO_FILE&#34;</span>&gt;&lt;/<span style=color:#f92672>audio</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;index.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>window.<span style=color:#a6e22e>AudioContext</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>AudioContext</span> <span style=color:#f92672>||</span> window.<span style=color:#a6e22e>webkitAudioContext</span> <span style=color:#f92672>||</span> window.<span style=color:#a6e22e>mozAudioContext</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>window.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(){
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>canvas</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;vis&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>canvasCtx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>getContext</span>(<span style=color:#e6db74>&#39;2d&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>isPlaying</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>audio</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;av&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>audioCtx</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AudioContext</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>analyser</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>audioCtx</span>.<span style=color:#a6e22e>createAnalyser</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>audioSrc</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>audioCtx</span>.<span style=color:#a6e22e>createMediaElementSource</span>(<span style=color:#a6e22e>audio</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>audioSrc</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>analyser</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>analyser</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>audioCtx</span>.<span style=color:#a6e22e>destination</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>analyser</span>.<span style=color:#a6e22e>fftSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2048</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>bufferLength</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>analyser</span>.<span style=color:#a6e22e>fftSize</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dataArray</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Uint8Array</span>(<span style=color:#a6e22e>bufferLength</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>analyser</span>.<span style=color:#a6e22e>getByteTimeDomainData</span>(<span style=color:#a6e22e>dataArray</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>WIDTH</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>500</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>HEIGHT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>150</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>requestAnimationFrame</span>(<span style=color:#a6e22e>draw</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isPlaying</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>analyser</span>.<span style=color:#a6e22e>getByteTimeDomainData</span>(<span style=color:#a6e22e>dataArray</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>canvasCtx</span>.<span style=color:#a6e22e>fillStyle</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;rgb(200, 200, 200)&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>canvasCtx</span>.<span style=color:#a6e22e>fillRect</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>WIDTH</span>, <span style=color:#a6e22e>HEIGHT</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>canvasCtx</span>.<span style=color:#a6e22e>lineWidth</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>canvasCtx</span>.<span style=color:#a6e22e>strokeStyle</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;rgb(0, 0, 0)&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>canvasCtx</span>.<span style=color:#a6e22e>beginPath</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sliceWidth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>WIDTH</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>bufferLength</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>bufferLength</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>dataArray</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>/</span> <span style=color:#ae81ff>128.0</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>HEIGHT</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>canvasCtx</span>.<span style=color:#a6e22e>moveTo</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>canvasCtx</span>.<span style=color:#a6e22e>lineTo</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>x</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>sliceWidth</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>canvasCtx</span>.<span style=color:#a6e22e>lineTo</span>(<span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>canvasCtx</span>.<span style=color:#a6e22e>stroke</span>();
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>audio</span>.<span style=color:#a6e22e>play</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>onclick</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>audio</span>, <span style=color:#a6e22e>isPlaying</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isPlaying</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>audio</span>.<span style=color:#a6e22e>pause</span>();
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>isPlaying</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>audio</span>.<span style=color:#a6e22e>play</span>();
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>isPlaying</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2><a href=/posts/move-to-caddy/>move to caddy</a></h2><p>去年用 Hexo 搭建的日志已经好几个月没更新了，最近休假有点空闲就继续更新吧。<br>先从 Github 迁移回自己的 Linode，然后安装一个 Caddyserver<a href=https://caddyserver.com/>1</a> 来渲染 markdown</p><blockquote><p>Caddy is a unique web server with a modern feature set. Think nginx or Apache, but written in Go. With Caddy, you can serve your websites over HTTP/2. It can act as a reverse proxy and load balancer. Front your PHP apps with it. You can even deploy your site with git push. Cool, right?<a href=https://blog.gopheracademy.com/caddy-a-look-inside/>2</a></p></blockquote><h2 id=download-and-install-systemd>Download and install systemd</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget -O <span style=color:#e6db74>&#39;caddy.tar.gz&#39;</span> <span style=color:#e6db74>&#39;https://caddyserver.com/download/build?os=linux&amp;arch=amd64&amp;features=git%2Cipfilter&#39;</span>
</span></span><span style=display:flex><span>tar zxf caddy.tar.gz
</span></span><span style=display:flex><span>mkdir /opt/caddy
</span></span><span style=display:flex><span>mkdir /var/run/caddy/
</span></span><span style=display:flex><span>chown caddy:caddy -R /opt/caddy
</span></span><span style=display:flex><span>chown caddy:caddy -R /var/run/caddy
</span></span><span style=display:flex><span>mv caddy /opt/caddy/
</span></span><span style=display:flex><span>useradd -d /var/run/caddy --system caddy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>644</span> /etc/systemd/system/caddy.service
</span></span><span style=display:flex><span>systemctl enable caddy.service
</span></span><span style=display:flex><span>systemctl start caddy.service
</span></span><span style=display:flex><span>systemctl status caddy.service
</span></span></code></pre></div><p><a href=https://github.com/caddyserver/examples/blob/master/systemd%2Fcaddy.service>https://github.com/caddyserver/examples/blob/master/systemd%2Fcaddy.service</a></p><h2><a href=/posts/mongodb-backup/>mongodb backup</a></h2><p>有台机器准备2月份下架
记一个 mongodb 备份小脚本 :)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># vim: set et sw=2 ts=2 sts=2 ff=unix fenc=utf8:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MONGO_DATABASE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_name_&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MONGO_HOST<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_ip_&#34;</span>
</span></span><span style=display:flex><span>MONGO_PORT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_prot_&#34;</span>
</span></span><span style=display:flex><span>TIMESTAMP<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date +%Y-%m-%dT%H:%M:%S<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>MONGODUMP_PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/usr/bin/mongodump&#34;</span>
</span></span><span style=display:flex><span>BACKUPS_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/data/dumps/&#34;</span>
</span></span><span style=display:flex><span>BACKUP_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$MONGO_DATABASE<span style=color:#e6db74>-</span>$TIMESTAMP<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> test $# -gt <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> in
</span></span><span style=display:flex><span>    -m<span style=color:#f92672>)</span> echo <span style=color:#e6db74>&#34;backup mongthly and clear week_dir&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#rm $BACKUPS_DIR&#34;week/*&#34;</span>
</span></span><span style=display:flex><span>      find $BACKUPS_DIR<span style=color:#e6db74>&#34;week&#34;</span> -type f -name <span style=color:#e6db74>&#39;*.tgz&#39;</span> -delete
</span></span><span style=display:flex><span>      tar -czPf $BACKUPS_DIR<span style=color:#e6db74>&#34;month/&#34;</span>$BACKUP_NAME.tgz $BACKUPS_DIR$MONGO_DATABASE
</span></span><span style=display:flex><span>      ;;
</span></span><span style=display:flex><span>    -w<span style=color:#f92672>)</span> echo <span style=color:#e6db74>&#34;backup weekly&#34;</span>
</span></span><span style=display:flex><span>      echo <span style=color:#e6db74>&#34;tar -czPf </span>$BACKUPS_DIR<span style=color:#e6db74>&#34;</span>week/<span style=color:#e6db74>&#34;</span>$BACKUP_NAME<span style=color:#e6db74>.tgz </span>$BACKUPS_DIR$MONGO_DATABASE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>      ;;
</span></span><span style=display:flex><span>    -d<span style=color:#f92672>)</span> echo <span style=color:#e6db74>&#34;just dump&#34;</span>
</span></span><span style=display:flex><span>      $MONGODUMP_PATH -d $MONGO_DATABASE --out $BACKUPS_DIR
</span></span><span style=display:flex><span>      ;;
</span></span><span style=display:flex><span>    *<span style=color:#f92672>)</span> echo <span style=color:#e6db74>&#34;do nothing&#34;</span>
</span></span><span style=display:flex><span>      ;;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>esac</span>
</span></span><span style=display:flex><span>  shift
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><pre tabindex=0><code class=language-cronjob data-lang=cronjob># crontab -e
10 3 * * * /bin/bash $HOME/bin/mongobackup.sh -d &gt; /dev/null 2&gt;&amp;1
20 3 * * 1 /bin/bash $HOME/bin/mongobackup.sh -w &gt; /dev/null 2&gt;&amp;1
30 3 1 * * /bin/bash $HOME/bin/mongobackup.sh -m &gt; /dev/null 2&gt;&amp;1
</code></pre><p>每天早上3点按天／周／月分别保存</p><h2><a href=/posts/let-s-encrypt/>let's encrypt</a></h2><p><a href=https://letsencrypt.org>Let&rsquo;s Encrypt</a> 已经公开测试，不需要再提交测试域名表单，直接就能申请<br>小项目以后都能用这玩意开 https 不用花钱买证书哦啦啦</p><p>照 <a href=https://letsencrypt.readthedocs.org/en/latest/using.html>文档</a> 做一遍给域名签上证书还挺简单的</p><p><img src=images/ssl.jpg alt=ssl></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 获取项目代码</span>
</span></span><span style=display:flex><span>git clone https://github.com/letsencrypt/letsencrypt
</span></span><span style=display:flex><span>cd letsencrypt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 安装依赖</span>
</span></span><span style=display:flex><span>./letsencrypt-auto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 获取证书</span>
</span></span><span style=display:flex><span>./letsencrypt-auto certonly --standalone -d www.example.com -d example.com
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 配置 nginx</span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen <span style=color:#ae81ff>443</span> ;
</span></span><span style=display:flex><span>  ssl on;
</span></span><span style=display:flex><span>  ssl_certificate_key /etc/letsencrypt/live/youdomain/privkey.pem;
</span></span><span style=display:flex><span>  ssl_certificate /etc/letsencrypt/live/youdomain/fullchain.pem;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><del>需要注意的是 dnspod 等国内服务解析域名有问题</del><br>我这里直接切回 domains.google.com 就行了<br>使用 standalone 模式需要先停掉默认的 nginx<br>文档里提到可以使用 webroot 模式不用停
但我创建验证文件失败了 :(<br>默认90天过期，建议 crontab 定时更新</p><p>###Update</p><p>使用 <a href=https://github.com/Neilpang/acme.sh>acme.sh</a></p><ul><li>An ACME protocol client written purely in Shell (Unix shell) language.</li><li>Fully ACME protocol implementation.</li><li>Simple, powerful and very easy to use. You only need 3 minutes to learn.</li><li>Bash, dash and sh compatible.</li><li>Simplest shell script for Let&rsquo;s Encrypt free certificate client.</li><li>Purely written in Shell with no dependencies on python or Let&rsquo;s Encrypt official client.</li><li>Just one script, to issue, renew and install your certificates automatically.</li></ul><p>或者 <a href=https://caddyserver.com>caddyserver</a></p><h2><a href=/posts/simple-nodejs-crawler/>simple crawler</a></h2><p>半夜看了本<a href=http://www.qidian.com/Book/3313422.aspx>小说</a>觉得翻页太累</p><p>首先要解决的问题是找一个质量还过得去的小说站
然后写个<a href=https://github.com/yanyaoer/crawler>脚本</a>去把它爬下来章节合并到一起</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>fs</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;fs&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>argv</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;process&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>request</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;request&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>cheerio</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;cheerio&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>iconv</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;iconv-lite&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>sanitize</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;sanitize-html&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>main</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>    Object.<span style=color:#a6e22e>assign</span>(<span style=color:#66d9ef>this</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./chapter.json&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>html</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./reader.html&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>url</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>list</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;http://www.piaotian.net/html/6/6658/&#39;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>store</span><span style=color:#f92672>:</span> []
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>callback</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>url</span>, {<span style=color:#a6e22e>encoding</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>}, (<span style=color:#a6e22e>error</span>, <span style=color:#a6e22e>response</span>, <span style=color:#a6e22e>body</span>)=&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>error</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>statusCode</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>$</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cheerio</span>.<span style=color:#a6e22e>load</span>(<span style=color:#a6e22e>iconv</span>.<span style=color:#a6e22e>decode</span>(<span style=color:#a6e22e>body</span>, <span style=color:#e6db74>&#39;GBK&#39;</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>callback</span>(<span style=color:#a6e22e>$</span>, <span style=color:#a6e22e>body</span>);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>runchapter</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>d</span>=&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>content</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fetch</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>list</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>href</span>, (<span style=color:#a6e22e>$</span>, <span style=color:#a6e22e>body</span>)=&gt; {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>iconv</span>.<span style=color:#a6e22e>decode</span>(<span style=color:#a6e22e>body</span>, <span style=color:#e6db74>&#39;GBK&#39;</span>);
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sanitize</span>(<span style=color:#a6e22e>content</span>);
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>save</span>();
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;runchapter fail: &#39;</span>, <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>title</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>output</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>output</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//let content = this.store.slice(0, 2)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span>
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>d</span>=&gt; <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>content</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39;&lt;hr /&gt;&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>html</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`&lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;meta charset=&#34;utf8&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;style&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ul, table, div {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          display: none;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        hr {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          height: 1px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          margin: 4rem 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        body {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          padding: 0 20%;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          font:24px/1.5 &#39;Songti Sc&#39;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;/style&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;body&gt;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>content</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;/body&gt;&lt;/html&gt;`</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>writeFileSync</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>html</span>, <span style=color:#a6e22e>html</span>, <span style=color:#e6db74>&#39;utf8&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>reload</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fetch</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>list</span>, (<span style=color:#a6e22e>$</span>)=&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;.mainbody .centent ul li a&#39;</span>).<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>d</span>)=&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>el</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$</span>(<span style=color:#a6e22e>d</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#39;href&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>href</span>.<span style=color:#a6e22e>endsWith</span>(<span style=color:#e6db74>&#39;.html&#39;</span>)) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span>.<span style=color:#a6e22e>push</span>({ <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>href</span>, <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>text</span>() })
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>save</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>runchapter</span>();
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>config</span>(<span style=color:#a6e22e>force</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>force</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>reload</span>();
</span></span><span style=display:flex><span>    } <span style=color:#a6e22e>esle</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>text</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>path</span>, <span style=color:#e6db74>&#39;utf8&#39;</span>).<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>text</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>runchapter</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>save</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>writeFileSync</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span>), <span style=color:#e6db74>&#39;utf8&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>force</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>argv</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;-f&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;run: &#39;</span>, <span style=color:#a6e22e>argv</span>[<span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>force</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>config</span>(<span style=color:#a6e22e>force</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>main</span>().<span style=color:#a6e22e>init</span>();
</span></span></code></pre></div><p>于是就水出来一篇日志啦</p><h2><a href=/posts/send-notification-after-task-end/>send notification when task finish</a></h2><p>终端里运行长时间任务(比如 <code>make systemimage</code>)的时候经常会切换到其他环境做别的事情
容易忘记查看之前的任务是否完成, 查到一些方法用在任务结束时发出通知</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#C-z 切到后台运行</span>
</span></span><span style=display:flex><span>fg; tput bel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Mac OS X</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#系统弹窗</span>
</span></span><span style=display:flex><span>osascript -e <span style=color:#e6db74>&#39;tell app &#34;System Events&#34; to display alert &#34;Build Completed&#34; message &#34;The checkout and build have completed.&#34;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>say <span style=color:#e6db74>&#34;Job finished&#34;</span> <span style=color:#75715e>#语音播报</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#notification center</span>
</span></span><span style=display:flex><span>osascript -e <span style=color:#e6db74>&#39;display notification &#34;Job finished&#34; with title &#34;Alert&#34;&#39;</span>
</span></span><span style=display:flex><span>sudo gem install terminal-notifier
</span></span><span style=display:flex><span>terminal-notifier -message <span style=color:#e6db74>&#34;Job finished!&#34;</span> -title <span style=color:#e6db74>&#34;Alert&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ubuntu</span>
</span></span><span style=display:flex><span>notify-send <span style=color:#e6db74>&#34;Job finished!&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># KDE</span>
</span></span><span style=display:flex><span>kdialog --passivepopup <span style=color:#e6db74>&#39;Job finished&#39;</span>
</span></span></code></pre></div><p>还有 <a href=https://iterm2.com/documentation-triggers.html>iterm2 trigger</a> 也能用来触发通知, 高亮文字</p><h2><a href=/posts/cname-with-yanyao-com/>create CNAME with internationalized domain name</a></h2><p>前段时间买了个 <a href=https://en.wikipedia.org/wiki/Internationalized_domain_name>idn</a>: yányào.com 闲置了很长时间没动
趁着十一长假无所事事的机会, 把玩了一下 <a href=https://hexo.io>hexo</a> 挂到 yanyaoer.github.io</p><p>然后 CNAME 的时候掉坑了, 看到有人说30分钟生效傻傻等就不提了
实际上这个域名的 CNAME 内容应该用编码后的字符串而不是 yányào.com</p><p><a href=https://github.com/yanyaoer/yanyaoer.github.io/commit/7c0e4e6863904442d368e3ad5c822f8f189bb7fc#diff-adc4bfdb0829dae99e3699393e3fbaa4>https://github.com/yanyaoer/yanyaoer.github.io/commit/7c0e4e6863904442d368e3ad5c822f8f189bb7fc#diff-adc4bfdb0829dae99e3699393e3fbaa4</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>diff --git a/CNAME b/CNAME
</span></span><span style=display:flex><span>index 6cb647c..92d166c 100644
</span></span><span style=display:flex><span><span style=color:#f92672>--- a/CNAME
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+++ b/CNAME
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span><span style=color:#75715e>@@ -1 +1 @@
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>-yányào.com
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+xn--ynyo-2nad.com
</span></span></span></code></pre></div><h2><a href=/posts/xtag-and-shadowdom/>xtag-and-shadowdom</a></h2><p>最近在做的项目重构, 原本打算用 reactjs, 写了一些实验代码后心累无爱
找了个 domdiff 配合自定义标签和 shadowdom 的独有作用域也是爽 YY</p><p>可惜的是测试红米上的 android webview 版本(32?)不支持 ::shadow 伪类
inline 方式覆盖样式略嫌繁琐</p><h2 id=示例代码>示例代码</h2><h3 id=xtagjs>xtag.js</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dom</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>shadow</span>(<span style=color:#a6e22e>el</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>createShadowRoot</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>createShadowRoot</span>() <span style=color:#f92672>:</span> <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>webkitCreateShadowRoot</span>();
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>attr</span>(<span style=color:#a6e22e>el</span>, <span style=color:#a6e22e>prefix</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>dataset</span>).<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>d</span>)=&gt; <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>prefix</span><span style=color:#e6db74>}${</span><span style=color:#a6e22e>d</span><span style=color:#e6db74>}</span><span style=color:#e6db74>=&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>dataset</span>[<span style=color:#a6e22e>d</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;`</span>).<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39; &#39;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>document.<span style=color:#a6e22e>registerElement</span>(<span style=color:#e6db74>&#39;x-image&#39;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>prototype</span><span style=color:#f92672>:</span> Object.<span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>HTMLElement</span>.<span style=color:#a6e22e>prototype</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>createdCallback</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>value</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>//xtag 嵌套时这里读不到attr, 放到 attach
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;onCreate::image&#39;</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>attachedCallback</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>value</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;onAttach::image&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>shadow</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>dom</span>.<span style=color:#a6e22e>shadow</span>(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>shadow</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`&lt;style&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            img { max-width: 100%; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &lt;/style&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &lt;img </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>dom</span>.<span style=color:#a6e22e>attr</span>(<span style=color:#66d9ef>this</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74> /&gt;`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>onclick</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>e</span>) =&gt; {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// other x-tag;
</span></span></span></code></pre></div><h3 id=indexjs>index.js</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#39;babel/polyfill&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#39;./xtag.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BaseView</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>opt</span>) {
</span></span><span style=display:flex><span>    Object.<span style=color:#a6e22e>assign</span>(<span style=color:#66d9ef>this</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>root</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>dom</span>(<span style=color:#e6db74>&#39;#app&#39;</span>)
</span></span><span style=display:flex><span>    }, <span style=color:#a6e22e>opt</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mount</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;event::mount&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>onCreate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;event::create&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>onUpdate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;event::update&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BannerView</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseView</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>init</span>(...<span style=color:#a6e22e>args</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mount</span>(...<span style=color:#a6e22e>args</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>`&lt;x-image data-src=&#34;</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>src</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                     data-href=&#34;</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>redirect_url</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34; /&gt;`</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=links>links</h2><p><a href=http://www.html5rocks.com/en/tutorials/webcomponents/customelements/>http://www.html5rocks.com/en/tutorials/webcomponents/customelements/</a>
<a href=http://www.html5rocks.com/en/tutorials/webcomponents/shadowdom-301/>http://www.html5rocks.com/en/tutorials/webcomponents/shadowdom-301/</a></p><h2><a href=/posts/remote-pbcopy-with-netcat/>remote pbcopy with netcat</a></h2><h2 id=quick-start>Quick start</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>true<span style=color:#f92672>)</span>; <span style=color:#66d9ef>do</span> nc -l <span style=color:#ae81ff>2224</span> | pbcopy; <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#If your laptop is running linux, replacing pbcopy with xcopy should work:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#while (true); do nc -l 2224 | xcopy; done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;This text gets sent to clipboard&#34;</span> | nc localhost <span style=color:#ae81ff>2224</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;RemoteForward 2224 localhost:2224&#34;</span> &gt;&gt; ~/.ssh/config
</span></span><span style=display:flex><span>ssh remote -t <span style=color:#e6db74>&#39;cat blablabla | nc -q0 localhost 2224&#39;</span>
</span></span></code></pre></div><h2 id=daemonizing-pbcopy>Daemonizing pbcopy</h2><p><code>launchctl load ~/Library/LaunchAgents/local.pbcopy.plist</code></p><pre tabindex=0><code class=language-plist data-lang=plist>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;!DOCTYPE plist PUBLIC &#34;-//Apple Computer//DTD PLIST 1.0//EN&#34; &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;
&lt;plist version=&#34;1.0&#34;&gt;
&lt;dict&gt;
    &lt;key&gt;Label&lt;/key&gt;
    &lt;string&gt;localhost.pbcopy&lt;/string&gt;
    &lt;key&gt;ProgramArguments&lt;/key&gt;
    &lt;array&gt;
       &lt;string&gt;/usr/bin/pbcopy&lt;/string&gt;
    &lt;/array&gt;
    &lt;key&gt;inetdCompatibility&lt;/key&gt;
    &lt;dict&gt;
       &lt;key&gt;Wait&lt;/key&gt;
       &lt;false/&gt;
    &lt;/dict&gt;
    &lt;key&gt;Sockets&lt;/key&gt;
    &lt;dict&gt;
       &lt;key&gt;Listeners&lt;/key&gt;
       &lt;dict&gt;
           &lt;key&gt;SockServiceName&lt;/key&gt;
           &lt;string&gt;2224&lt;/string&gt;
           &lt;key&gt;SockNodeName&lt;/key&gt;
           &lt;string&gt;127.0.0.1&lt;/string&gt;
       &lt;/dict&gt;
    &lt;/dict&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre><h2 id=remote-pbcopy>Remote pbcopy</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>scp pbcopy remote:/path_to/pbcopy
</span></span><span style=display:flex><span>chmod a+x path_to/pbcopy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> -n <span style=color:#e6db74>&#34;</span>$SSH_CLIENT<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> SESSION_TYPE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;remote&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $SESSION_TYPE <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;remote&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  cat | nc -q0 localhost <span style=color:#ae81ff>2224</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  cat | pbcopy
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><h2 id=links>links</h2><p><a href=http://brettterpstra.com/2014/02/19/remote-pbcopy-on-os-x-systems/>http://brettterpstra.com/2014/02/19/remote-pbcopy-on-os-x-systems/</a></p><h2><a href=/posts/postfix-forward-mail/>forward email by postfix</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo aptitude install postfix
</span></span><span style=display:flex><span>hostname -f
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># sudo vim /etc/postfix/main.cf</span>
</span></span><span style=display:flex><span>myhostname <span style=color:#f92672>=</span> example.com
</span></span><span style=display:flex><span>myorigin <span style=color:#f92672>=</span> example.com
</span></span><span style=display:flex><span>mydestination <span style=color:#f92672>=</span> example1.com, example2.com, ...
</span></span><span style=display:flex><span>virtual_alias_maps <span style=color:#f92672>=</span> hash:/etc/postfix/virtual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># sudo vim /etc/postfix/virtual</span>
</span></span><span style=display:flex><span>@example1.com    name@forward.com
</span></span><span style=display:flex><span>@example2.com    name@forward.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo postmap /etc/postfix/virtual
</span></span><span style=display:flex><span>sudo /etc/init.d/postfix reload
</span></span></code></pre></div><p><a href=https://wiki.debian.org/Postfix#Forward_Emails>https://wiki.debian.org/Postfix#Forward_Emails</a></p><p><a href=https://www.linode.com/docs/email/postfix/basic-postfix-email-gateway-on-debian-6-squeeze>https://www.linode.com/docs/email/postfix/basic-postfix-email-gateway-on-debian-6-squeeze</a></p><p><a href=https://www.debian-administration.org/article/243/Handling_mail_for_multiple_virtual_domains_with_postfix>https://www.debian-administration.org/article/243/Handling_mail_for_multiple_virtual_domains_with_postfix</a></p><h2><a href=/posts/mitmproxy/>mitmproxy</a></h2><p><a href=http://mitmproxy.org>mitmproxy</a> 是个命令行下查看/修改 http 请求的交互式工具</p><p>#截图
<img src=http://mitmproxy.org/doc/screenshots/mitmproxy.png alt=screenshoot>
<img src=http://mitmproxy.org/doc/screenshots/mitmproxy-flowview.png alt=screenshoot></p><p>#安装</p><pre><code>sudo apt-get install python-dev libffi-dev
pip install mitmproxy
</code></pre><p>#使用</p><p><strong>ubuntu 上启动 mitmproxy</strong><br>mitmproxy &ndash;host</p><p><strong>手机 设置 -> WLAN -> 代理</strong><br>主机名: ubuntu 的 ip<br>端口: 8080</p><p>然后访问网络就会在 mitmproxy 里看到请求记录(如截图)</p><p>#快捷键</p><p>j,k 上下移动<br>enter 进入<br>tab 切换 request/response</p><p>#参考
<a href=http://mitmproxy.org/doc/mitmproxy.html>http://mitmproxy.org/doc/mitmproxy.html</a><br><a href=http://blog.philippheckel.com/2013/07/01/how-to-use-mitmproxy-to-read-and-modify-https-traffic-of-your-phone/>http://blog.philippheckel.com/2013/07/01/how-to-use-mitmproxy-to-read-and-modify-https-traffic-of-your-phone/</a></p><h2><a href=/posts/brick-intro/>brick intro</a></h2><p>#Introducing Brick: Minimal-markup Web Components for Faster App Development
#介绍 brick: 用于快速开发 webapp 的自定义标签组件</p><p><a href=https://hacks.mozilla.org/2013/08/introducing-brick-minimal-markup-web-components-for-faster-app-development/>https://hacks.mozilla.org/2013/08/introducing-brick-minimal-markup-web-components-for-faster-app-development/</a></p><p>Those of you on the cutting HTML5 edge may have already heard of the exciting Web Components specification. If you haven’t, you’ll probably want to read up on what makes this so exciting, but long story short, Web Components promise to open up a new realm of development by letting web developers write custom, reusable HTML tags. Think of them as JavaScript plugins without the need for additional code initialization or boilerplate markup/styling.</p><h2><a href=/posts/my-osx-setup/>my osx setup</a></h2><p>#setting</p><pre tabindex=0><code># Enable full keyboard access for all controls
defaults write NSGlobalDomain AppleKeyboardUIMode -int 3

# Disable menu bar transparency
defaults write NSGlobalDomain AppleEnableMenuBarTransparency -bool false

# Allow quitting Finder via ⌘ + Q; doing so will also hide desktop icons
defaults write com.apple.finder QuitMenuItem -bool true

# Avoid creating .DS_Store files on network volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true

# Disable the warning when changing a file extension
defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false

# Enable tap to click (Trackpad)
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -bool true

# Enable Safari’s debug menu
defaults write com.apple.Safari IncludeInternalDebugMenu -bool true

# To pin the dock to the right bottom
defaults write com.apple.dock pinning -string end
defaults write com.apple.dock orientation -string right

# Only Show Open Applications In The Dock
defaults write com.apple.dock static-only -bool true

defaults write com.apple.dock tilesize -int 24
defaults write com.apple.finder QLEnableTextSelection -bool true

# disable dashboard
defaults write com.apple.dashboard mcx-disabled -boolean true
</code></pre><p>#<a href=http://itunes.apple.com/us/app/xcode/>xcode</a> with <a href=https://developer.apple.com/downloads>Command Line Tools</a></p></main><footer><p>Copyright 2025. All rights reserved.</p></footer></body></html>