<!doctype html><html lang=en-US><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=#ZgotmplZ><title>simple crawler | yÃ¡nyÃ o.com</title>
<meta name=title content="simple crawler"><meta name=description content="åŠå¤œçœ‹äº†æœ¬å°è¯´è§‰å¾—ç¿»é¡µå¤ªç´¯
é¦–å…ˆè¦è§£å†³çš„é—®é¢˜æ˜¯æ‰¾ä¸€ä¸ªè´¨é‡è¿˜è¿‡å¾—å»çš„å°è¯´ç«™
ç„¶åå†™ä¸ªè„šæœ¬å»æŠŠå®ƒçˆ¬ä¸‹æ¥ç« èŠ‚åˆå¹¶åˆ°ä¸€èµ·
import fs from &#34;fs&#34;;
import { argv } from &#34;process&#34;;
import request from &#34;request&#34;;
import cheerio from &#34;cheerio&#34;;
import iconv from &#34;iconv-lite&#34;;
import sanitize from 'sanitize-html';


class main {
  constructor() {
    Object.assign(this, {
      path: './chapter.json',
      html: './reader.html',
      url: {
        list: 'http://www.piaotian.net/html/6/6658/'
      },
      store: []
    })
  }
  fetch(url, callback) {
    request.get(url, {encoding: null}, (error, response, body)=> {
      if (!error && response.statusCode == 200) {
        let $ = cheerio.load(iconv.decode(body, 'GBK'));
        callback($, body);
      } else {
        console.log(url);
      }
    })
  }
  runchapter() {
    this.store.map(d=> {
      if (!d.content) {
        this.fetch(this.url.list + d.href, ($, body)=> {
          let content = iconv.decode(body, 'GBK');
          d.content = sanitize(content);
          this.save();
        })
      } else {
        console.log('runchapter fail: ', d.id, d.title);
      }
    })
    this.output();
  }
  output() {
    //let content = this.store.slice(0, 2)
    let content = this.store
      .map(d=> d.content)
      .join('<hr />');
    let html = `<html>
    <head>
      <meta charset=&#34;utf8&#34; />
      <style>
        ul, table, div {
          display: none;
        }
        hr {
          height: 1px;
          margin: 4rem 0;
        }
        body {
          padding: 0 20%;
          font:24px/1.5 'Songti Sc';
        }
      </style>
    </head>
    <body>${content}</body></html>`;
    fs.writeFileSync(this.html, html, 'utf8');
  }
  reload() {
    this.fetch(this.url.list, ($)=> {
      this.store = [];
      $('.mainbody .centent ul li a').map((id, d)=> {
        let el = $(d);
        let href = el.attr('href');
        if (!href.endsWith('.html')) {
          return
        }
        this.store.push({ id, href, title: el.text() })
      })
      this.save();
      this.runchapter();
    })
  }
  config(force){
    if (force) {
      this.reload();
    } esle {
      let text = fs.readFileSync(this.path, 'utf8').toString();
      this.store = JSON.parse(text);
      this.runchapter();
    }
  }
  save() {
    fs.writeFileSync(this.path, JSON.stringify(this.store), 'utf8');
  }
  init() {
    let force = argv[2] === '-f';
    console.log('run: ', argv[2], force);
    this.config(force);
  }
}

new main().init();
äºæ˜¯å°±æ°´å‡ºæ¥ä¸€ç¯‡æ—¥å¿—å•¦"><meta name=keywords content="nodejs,crawler,"><link rel=canonical href=https://xn--ynyo-2nad.com/posts/simple-nodejs-crawler/><meta property="og:url" content="https://xn--ynyo-2nad.com/posts/simple-nodejs-crawler/"><meta property="og:site_name" content="yÃ¡nyÃ o.com"><meta property="og:title" content="simple crawler"><meta property="og:description" content="åŠå¤œçœ‹äº†æœ¬å°è¯´è§‰å¾—ç¿»é¡µå¤ªç´¯
é¦–å…ˆè¦è§£å†³çš„é—®é¢˜æ˜¯æ‰¾ä¸€ä¸ªè´¨é‡è¿˜è¿‡å¾—å»çš„å°è¯´ç«™ ç„¶åå†™ä¸ªè„šæœ¬å»æŠŠå®ƒçˆ¬ä¸‹æ¥ç« èŠ‚åˆå¹¶åˆ°ä¸€èµ·
import fs from &#34;fs&#34;; import { argv } from &#34;process&#34;; import request from &#34;request&#34;; import cheerio from &#34;cheerio&#34;; import iconv from &#34;iconv-lite&#34;; import sanitize from 'sanitize-html'; class main { constructor() { Object.assign(this, { path: './chapter.json', html: './reader.html', url: { list: 'http://www.piaotian.net/html/6/6658/' }, store: [] }) } fetch(url, callback) { request.get(url, {encoding: null}, (error, response, body)=> { if (!error && response.statusCode == 200) { let $ = cheerio.load(iconv.decode(body, 'GBK')); callback($, body); } else { console.log(url); } }) } runchapter() { this.store.map(d=> { if (!d.content) { this.fetch(this.url.list + d.href, ($, body)=> { let content = iconv.decode(body, 'GBK'); d.content = sanitize(content); this.save(); }) } else { console.log('runchapter fail: ', d.id, d.title); } }) this.output(); } output() { //let content = this.store.slice(0, 2) let content = this.store .map(d=> d.content) .join('<hr />'); let html = `<html> <head> <meta charset=&#34;utf8&#34; /> <style> ul, table, div { display: none; } hr { height: 1px; margin: 4rem 0; } body { padding: 0 20%; font:24px/1.5 'Songti Sc'; } </style> </head> <body>${content}</body></html>`; fs.writeFileSync(this.html, html, 'utf8'); } reload() { this.fetch(this.url.list, ($)=> { this.store = []; $('.mainbody .centent ul li a').map((id, d)=> { let el = $(d); let href = el.attr('href'); if (!href.endsWith('.html')) { return } this.store.push({ id, href, title: el.text() }) }) this.save(); this.runchapter(); }) } config(force){ if (force) { this.reload(); } esle { let text = fs.readFileSync(this.path, 'utf8').toString(); this.store = JSON.parse(text); this.runchapter(); } } save() { fs.writeFileSync(this.path, JSON.stringify(this.store), 'utf8'); } init() { let force = argv[2] === '-f'; console.log('run: ', argv[2], force); this.config(force); } } new main().init(); äºæ˜¯å°±æ°´å‡ºæ¥ä¸€ç¯‡æ—¥å¿—å•¦"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-10-17T12:06:21+00:00"><meta property="article:modified_time" content="2015-10-17T12:06:21+00:00"><meta property="article:tag" content="Nodejs"><meta property="article:tag" content="Crawler"><meta property="og:image" content="https://xn--ynyo-2nad.com/images/share.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://xn--ynyo-2nad.com/images/share.png"><meta name=twitter:title content="simple crawler"><meta name=twitter:description content="åŠå¤œçœ‹äº†æœ¬å°è¯´è§‰å¾—ç¿»é¡µå¤ªç´¯
é¦–å…ˆè¦è§£å†³çš„é—®é¢˜æ˜¯æ‰¾ä¸€ä¸ªè´¨é‡è¿˜è¿‡å¾—å»çš„å°è¯´ç«™ ç„¶åå†™ä¸ªè„šæœ¬å»æŠŠå®ƒçˆ¬ä¸‹æ¥ç« èŠ‚åˆå¹¶åˆ°ä¸€èµ·
import fs from &#34;fs&#34;; import { argv } from &#34;process&#34;; import request from &#34;request&#34;; import cheerio from &#34;cheerio&#34;; import iconv from &#34;iconv-lite&#34;; import sanitize from 'sanitize-html'; class main { constructor() { Object.assign(this, { path: './chapter.json', html: './reader.html', url: { list: 'http://www.piaotian.net/html/6/6658/' }, store: [] }) } fetch(url, callback) { request.get(url, {encoding: null}, (error, response, body)=> { if (!error && response.statusCode == 200) { let $ = cheerio.load(iconv.decode(body, 'GBK')); callback($, body); } else { console.log(url); } }) } runchapter() { this.store.map(d=> { if (!d.content) { this.fetch(this.url.list + d.href, ($, body)=> { let content = iconv.decode(body, 'GBK'); d.content = sanitize(content); this.save(); }) } else { console.log('runchapter fail: ', d.id, d.title); } }) this.output(); } output() { //let content = this.store.slice(0, 2) let content = this.store .map(d=> d.content) .join('<hr />'); let html = `<html> <head> <meta charset=&#34;utf8&#34; /> <style> ul, table, div { display: none; } hr { height: 1px; margin: 4rem 0; } body { padding: 0 20%; font:24px/1.5 'Songti Sc'; } </style> </head> <body>${content}</body></html>`; fs.writeFileSync(this.html, html, 'utf8'); } reload() { this.fetch(this.url.list, ($)=> { this.store = []; $('.mainbody .centent ul li a').map((id, d)=> { let el = $(d); let href = el.attr('href'); if (!href.endsWith('.html')) { return } this.store.push({ id, href, title: el.text() }) }) this.save(); this.runchapter(); }) } config(force){ if (force) { this.reload(); } esle { let text = fs.readFileSync(this.path, 'utf8').toString(); this.store = JSON.parse(text); this.runchapter(); } } save() { fs.writeFileSync(this.path, JSON.stringify(this.store), 'utf8'); } init() { let force = argv[2] === '-f'; console.log('run: ', argv[2], force); this.config(force); } } new main().init(); äºæ˜¯å°±æ°´å‡ºæ¥ä¸€ç¯‡æ—¥å¿—å•¦"><meta itemprop=name content="simple crawler"><meta itemprop=description content="åŠå¤œçœ‹äº†æœ¬å°è¯´è§‰å¾—ç¿»é¡µå¤ªç´¯
é¦–å…ˆè¦è§£å†³çš„é—®é¢˜æ˜¯æ‰¾ä¸€ä¸ªè´¨é‡è¿˜è¿‡å¾—å»çš„å°è¯´ç«™ ç„¶åå†™ä¸ªè„šæœ¬å»æŠŠå®ƒçˆ¬ä¸‹æ¥ç« èŠ‚åˆå¹¶åˆ°ä¸€èµ·
import fs from &#34;fs&#34;; import { argv } from &#34;process&#34;; import request from &#34;request&#34;; import cheerio from &#34;cheerio&#34;; import iconv from &#34;iconv-lite&#34;; import sanitize from 'sanitize-html'; class main { constructor() { Object.assign(this, { path: './chapter.json', html: './reader.html', url: { list: 'http://www.piaotian.net/html/6/6658/' }, store: [] }) } fetch(url, callback) { request.get(url, {encoding: null}, (error, response, body)=> { if (!error && response.statusCode == 200) { let $ = cheerio.load(iconv.decode(body, 'GBK')); callback($, body); } else { console.log(url); } }) } runchapter() { this.store.map(d=> { if (!d.content) { this.fetch(this.url.list + d.href, ($, body)=> { let content = iconv.decode(body, 'GBK'); d.content = sanitize(content); this.save(); }) } else { console.log('runchapter fail: ', d.id, d.title); } }) this.output(); } output() { //let content = this.store.slice(0, 2) let content = this.store .map(d=> d.content) .join('<hr />'); let html = `<html> <head> <meta charset=&#34;utf8&#34; /> <style> ul, table, div { display: none; } hr { height: 1px; margin: 4rem 0; } body { padding: 0 20%; font:24px/1.5 'Songti Sc'; } </style> </head> <body>${content}</body></html>`; fs.writeFileSync(this.html, html, 'utf8'); } reload() { this.fetch(this.url.list, ($)=> { this.store = []; $('.mainbody .centent ul li a').map((id, d)=> { let el = $(d); let href = el.attr('href'); if (!href.endsWith('.html')) { return } this.store.push({ id, href, title: el.text() }) }) this.save(); this.runchapter(); }) } config(force){ if (force) { this.reload(); } esle { let text = fs.readFileSync(this.path, 'utf8').toString(); this.store = JSON.parse(text); this.runchapter(); } } save() { fs.writeFileSync(this.path, JSON.stringify(this.store), 'utf8'); } init() { let force = argv[2] === '-f'; console.log('run: ', argv[2], force); this.config(force); } } new main().init(); äºæ˜¯å°±æ°´å‡ºæ¥ä¸€ç¯‡æ—¥å¿—å•¦"><meta itemprop=datePublished content="2015-10-17T12:06:21+00:00"><meta itemprop=dateModified content="2015-10-17T12:06:21+00:00"><meta itemprop=wordCount content="261"><meta itemprop=image content="https://xn--ynyo-2nad.com/images/share.png"><meta itemprop=keywords content="Nodejs,Crawler"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width-max:720px;--font-primary:Verdana, sans-serif;--font-secondary:monospace;--font-size-primary:1em;--font-size-secondary:0.8em;--body-bg-color:#fcfcfc;--bold-text-color:#222;--body-text-color:#444;--link-color:#3273dc;--link-visited-color:#8b6fcb;--table-border-color:#f2f2f2;--table-th-bg-color:#f2f2f2;--img-border-color:#f2f2f2;--code-bg-color:#f2f2f2;--code-text-color:#222;--blockquote-border-color:#666;--blockquote-text-color:#666;--upvoted-color:#FA8072}@media(prefers-color-scheme:dark){:root{--body-bg-color:#1c1c1c;--bold-text-color:#eee;--body-text-color:#ddd;--link-color:#8cc2dd;--link-visited-color:#c3b1ee;--table-border-color:#999;--table-th-bg-color:#999;--img-border-color:#999;--code-bg-color:#555;--code-text-color:#ddd;--blockquote-border-color:#ccc;--blockquote-text-color:#ccc}}body{font-family:var(--font-primary);font-size:var(--font-size-primary);margin:auto;padding:20px;max-width:var(--width-max);text-align:left;background-color:var(--body-bg-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--body-text-color)}h1,h2,h3,h4,h5,h6,strong,b{color:var(--bold-text-color)}h1,h2,h3,h4,h5,h6{margin:16px 0}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}.title{text-decoration:none;border:0}.title:hover{text-decoration:none}.title span{font-weight:400}nav a{margin-right:8px}textarea{width:100%;font-size:16px}input{font-size:14px}content{line-height:1.6}table{width:100%;border-collapse:collapse;border:1px solid var(--table-border-color);border-radius:4px}th,td{border:1px solid var(--table-border-color);padding:4px}th{background-color:var(--table-th-bg-color)}hr{border:0;border-top:1px dashed}img{max-width:100%;display:block;margin-left:auto;margin-right:auto;border:1px solid var(--img-border-color);border-radius:4px;content-visibility:auto;loading:lazy}img[src*="#minipic"]{max-width:50%;margin-left:0;margin-right:auto}i{font-style:normal}time{font-family:var(--font-secondary);font-size:15px}code{font-family:var(--font-secondary);background-color:var(--code-bg-color);color:var(--code-text-color);padding:2px;border-radius:4px}pre code{display:block;padding:16px;white-space:pre-wrap;overflow-x:auto}div.highlight pre{border-radius:4px}div.highlight code{background-color:var(--code-bg-color);color:var(--code-text-color)}blockquote{border-left:2px solid var(--blockquote-border-color);color:var(--blockquote-text-color);margin:0;padding-left:16px;font-style:normal}blockquote p{margin:0}footer{padding:25px 0;text-align:center;font-size:var(--font-size-secondary)}ul li:has(input){list-style-type:none;margin-left:-25.5px}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li span.grouped{flex:0 0 80px}ul.blog-posts li a:visited{color:var(--link-visited-color)}div.toc{position:fixed;top:50%;left:calc((100vw + var(--width-max))/2);transform:translateY(-50%);width:calc((90vw - var(--width-max))/2);max-height:80vh;overflow-y:auto;padding:20px 8px;z-index:99;&::-webkit-scrollbar { display:none; } -ms-overflow-style:none;scrollbar-width:none}div.toc ul{list-style-type:none;padding-left:0}div.toc ul li{margin:8px 0}div.toc ul li a{text-decoration:none;color:var(--blockquote-text-color)}div.toc ul li a:hover{color:var(--link-color)}button.upvote-btn{margin:0;padding:0;border:none;background:0 0;cursor:pointer;display:flex;flex-direction:column;align-items:center;color:var(--body-text-color)}button.upvoted{color:var(--upvoted-color)}span.upvote-count{margin-top:-4px;font-size:smaller}@media(max-width:500px){img[src*="#minipic"]{max-width:100%;margin-left:auto;margin-right:auto}div.toc{display:none}}</style></head><body><header><a href=/ class=title><h1>yÃ¡nyÃ o.com</h1></a><nav><a href=/>Home</a></nav></header><main><content><p>åŠå¤œçœ‹äº†æœ¬<a href=http://www.qidian.com/Book/3313422.aspx>å°è¯´</a>è§‰å¾—ç¿»é¡µå¤ªç´¯</p><p>é¦–å…ˆè¦è§£å†³çš„é—®é¢˜æ˜¯æ‰¾ä¸€ä¸ªè´¨é‡è¿˜è¿‡å¾—å»çš„å°è¯´ç«™
ç„¶åå†™ä¸ª<a href=https://github.com/yanyaoer/crawler>è„šæœ¬</a>å»æŠŠå®ƒçˆ¬ä¸‹æ¥ç« èŠ‚åˆå¹¶åˆ°ä¸€èµ·</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>fs</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;fs&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>argv</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;process&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>request</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;request&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>cheerio</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;cheerio&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>iconv</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;iconv-lite&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>sanitize</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;sanitize-html&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>main</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>    Object.<span style=color:#a6e22e>assign</span>(<span style=color:#66d9ef>this</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./chapter.json&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>html</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./reader.html&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>url</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>list</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;http://www.piaotian.net/html/6/6658/&#39;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>store</span><span style=color:#f92672>:</span> []
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>callback</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>url</span>, {<span style=color:#a6e22e>encoding</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>}, (<span style=color:#a6e22e>error</span>, <span style=color:#a6e22e>response</span>, <span style=color:#a6e22e>body</span>)=&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>error</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>statusCode</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>$</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cheerio</span>.<span style=color:#a6e22e>load</span>(<span style=color:#a6e22e>iconv</span>.<span style=color:#a6e22e>decode</span>(<span style=color:#a6e22e>body</span>, <span style=color:#e6db74>&#39;GBK&#39;</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>callback</span>(<span style=color:#a6e22e>$</span>, <span style=color:#a6e22e>body</span>);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>runchapter</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>d</span>=&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>content</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fetch</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>list</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>href</span>, (<span style=color:#a6e22e>$</span>, <span style=color:#a6e22e>body</span>)=&gt; {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>iconv</span>.<span style=color:#a6e22e>decode</span>(<span style=color:#a6e22e>body</span>, <span style=color:#e6db74>&#39;GBK&#39;</span>);
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sanitize</span>(<span style=color:#a6e22e>content</span>);
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>save</span>();
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;runchapter fail: &#39;</span>, <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>title</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>output</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>output</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//let content = this.store.slice(0, 2)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span>
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>d</span>=&gt; <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>content</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39;&lt;hr /&gt;&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>html</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`&lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;meta charset=&#34;utf8&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;style&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ul, table, div {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          display: none;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        hr {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          height: 1px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          margin: 4rem 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        body {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          padding: 0 20%;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          font:24px/1.5 &#39;Songti Sc&#39;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;/style&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;body&gt;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>content</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;/body&gt;&lt;/html&gt;`</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>writeFileSync</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>html</span>, <span style=color:#a6e22e>html</span>, <span style=color:#e6db74>&#39;utf8&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>reload</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fetch</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>list</span>, (<span style=color:#a6e22e>$</span>)=&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;.mainbody .centent ul li a&#39;</span>).<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>d</span>)=&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>el</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$</span>(<span style=color:#a6e22e>d</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#39;href&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>href</span>.<span style=color:#a6e22e>endsWith</span>(<span style=color:#e6db74>&#39;.html&#39;</span>)) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span>.<span style=color:#a6e22e>push</span>({ <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>href</span>, <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>text</span>() })
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>save</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>runchapter</span>();
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>config</span>(<span style=color:#a6e22e>force</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>force</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>reload</span>();
</span></span><span style=display:flex><span>    } <span style=color:#a6e22e>esle</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>text</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>path</span>, <span style=color:#e6db74>&#39;utf8&#39;</span>).<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>text</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>runchapter</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>save</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>writeFileSync</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>store</span>), <span style=color:#e6db74>&#39;utf8&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>force</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>argv</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;-f&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;run: &#39;</span>, <span style=color:#a6e22e>argv</span>[<span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>force</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>config</span>(<span style=color:#a6e22e>force</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>main</span>().<span style=color:#a6e22e>init</span>();
</span></span></code></pre></div><p>äºæ˜¯å°±æ°´å‡ºæ¥ä¸€ç¯‡æ—¥å¿—å•¦</p><p>æœ€è¿‘å„ç§å†™ es6
éƒ½å¿«å¿˜äº†
python æ€ä¹ˆç”¨
ä¸Šå‘¨
èŠ±ä¸€å¤©å°±
å†™2ä¸ªè„šæœ¬
å¾—æœè€&mldr;</p></content><p><a href=https://xn--ynyo-2nad.com/blog/nodejs/>#Nodejs</a>
<a href=https://xn--ynyo-2nad.com/blog/crawler/>#Crawler</a></p><div class=toc><nav id=TableOfContents></nav></div></main><footer>Subscribe via <a href=/index.xml>RSS</a>.<br>Made with
<a href=https://github.com/rokcso/hugo-bearblog-neo/>Hugo Bear Neo</a>.<br>ğŸ—ºï¸ <a href=/sitemap.xml>Sitemap</a>.</footer></body></html>