<!doctype html><html lang=en-US dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>poorman's ASR solution | yÃ¡nyÃ o.com</title><link rel=stylesheet href=/css/main.min.6f828ddf68bbacf732eaa73b52e82f5d9de0e36e874ab957dc8b22dac66d9fa7.css integrity="sha256-b4KN32i7rPcy6qc7UugvXZ3g426HSrlX3Isi2sZtn6c=" crossorigin=anonymous></head><body><header><header><a href=https://xn--ynyo-2nad.com/ class=title><h2>yÃ¡nyÃ o.com</h2></a><nav><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/index.xml>RSS</a></nav></header><main><h1>poorman's ASR solution</h1><time datetime=2025-05-11T17:50:56+08:00>May 11, 2025</time><h2 id=intro>Intro</h2><p>å¤§æ¦‚20å¹´h2æœŸé—´ï¼Œå¬é—»feishuæ”¯æŒäº†ä¼šè®®è‡ªåŠ¨è½¬è¯‘å­—å¹•åŠŸèƒ½ï¼Œbut
å½“æ—¶ç§æœ‰åŒ–éƒ¨ç½²çš„ç‰ˆæœ¬ä¸€ç›´æ²¡æœ‰æ”¯æŒï¼Œäºæ˜¯ç§ä¸‹æ‰¾äº†è¯­éŸ³åŠ©æ‰‹å›¢é˜Ÿçš„åŒå­¦ä¼å›¾è¹­æœåŠ¡ç”¨äºè‡ªåŠ¨ç”Ÿæˆä¼šè®®çºªè¦ï¼Œ<strong>æ‡’å³æ˜¯åŸåŠ¨åŠ›</strong></p><p>å† but ä¸€ä¸‹ï¼Œå‡ºäºæœåŠ¡æˆæœ¬è€ƒé‡æ²¡æœ‰è¹­æˆåŠŸï¼Œåæ¥å¯¹åº”çš„åŒå­¦ä¹Ÿé™†ç»­ç¦»èŒå°±æ²¡ä¸‹æ–‡äº†</p><p>23å¹´å¤§æ¨¡å‹å¼€å§‹å„ç§ç«çƒ­èµ·æ¥ï¼Œäºæ˜¯å€ŸåŠ© openai çš„ whisper
åœ¨æœ¬åœ°é™†ç»­å†™äº†ä¸€äº›éŸ³é¢‘è½¬æ–‡æœ¬çš„å°ä»»åŠ¡ï¼Œæ¯”å¦‚ yt-dlp ä¸‹è½½ bilibili
è§†é¢‘åè½¬éŸ³é¢‘å†è½¬æ–‡æœ¬ï¼Œä¸ªäººä¹ æƒ¯ä¸Šé˜…è¯»çš„æ•ˆç‡è¿˜æ˜¯é«˜äºè§†é¢‘å½¢å¼çš„</p><ul><li>[scribe] <a href=https://gist.github.com/yanyaoer/5cc7b0dd6729f306ad3cb740d501cabd>https://gist.github.com/yanyaoer/5cc7b0dd6729f306ad3cb740d501cabd</a></li></ul><p>å¦å¤–ç»“åˆè¯­éŸ³è¯†åˆ«å’Œ LLM çš„å‘æ•£ï¼Œä¹Ÿè¯•ç€æ“äº†ç‚¹è¯­éŸ³åŠ©æ‰‹çš„å°è¯•</p><ul><li>[voice assistant with computer-use] <a href=https://gist.github.com/yanyaoer/752a73d2d6df5a2aa0de179a0f68e8a1>https://gist.github.com/yanyaoer/752a73d2d6df5a2aa0de179a0f68e8a1</a></li><li>[hook for whisper llm-talk] <a href=https://github.com/yanyaoer/whisper.cpp/commit/da85a1b4791e4a7eeb5adb31d47d4c5e53618234>https://github.com/yanyaoer/whisper.cpp/commit/da85a1b4791e4a7eeb5adb31d47d4c5e53618234</a></li></ul><p>ä½†æ˜¯å®æ—¶è¯­éŸ³è¯†åˆ«åœºæ™¯ï¼Œç”¨ whiper-stream / sense-voice
è¿™ç±»æ–¹æ¡ˆè¿˜æ˜¯ä¼šæœ‰è¯†åˆ«ä¸å‡†ç¡®ã€å†…å®¹ä¸¢å¤±çš„é—®é¢˜å­˜åœ¨ï¼Œè°ƒæ•´ step/length
å‚æ•°æ•ˆæœä¹Ÿä¸æ˜æ˜¾ï¼Œvad æ–¹æ¡ˆå»¶è¿Ÿä¹Ÿå¾ˆé«˜&mldr;</p><h2 id=new-solution>New solution</h2><p>ä¸Šå‘¨å¿½ç„¶æƒ³èµ·äº† kaldi é¡¹ç›®ä¹Ÿè›®ç»å…¸äº†ï¼Œäºæ˜¯å°±è¯•ç€ç”¨ sherpa-[ncnn|onnx] å°è¯•äº†ä¸‹ demo
sherpa-[ncnn|onnx]-microphone
æµå¼è¯†åˆ«è¾“å‡ºçš„æ•´ä½“æ•ˆæœå·²ç»å¾ˆæ¥è¿‘æŠŠéŸ³é¢‘æ–‡ä»¶å–‚ç»™å¤§æ¨¡å‹çš„è´¨é‡</p><p>äºæ˜¯è”ç³»ç»´æŠ¤è€… @csukuangfj
è¯·æ•™æ€ä¹ˆæå‡è¯†åˆ«å‡†ç¡®ç‡ï¼Œå¤§ä½¬è¿‡äºå·å‘¨æœ«è¿˜ç»™é€ äº†æ–°æ–¹æ¡ˆå’Œè¾“å‡ºä¼˜åŒ–ï¼Œç”šè‡³è¿˜å½•äº† b
ç«™è§†é¢‘ <a href=https://www.bilibili.com/video/BV1xcEMz8EsX/>https://www.bilibili.com/video/BV1xcEMz8EsX/</a></p><iframe src="//player.bilibili.com/player.html?bvid=BV1xcEMz8EsX&page=1" scrolling=no autoplay border=0 frameborder=no framespacing=0 allowfullscreen></iframe><ul><li>[Add real-time speech recognition example for SenseVoice. (#2197)] <a href=https://github.com/k2-fsa/sherpa-onnx/commit/53518efd2fe70f49b86f180a4e5b49fdc374da82>https://github.com/k2-fsa/sherpa-onnx/commit/53518efd2fe70f49b86f180a4e5b49fdc374da82</a></li><li>[Fix displaying streaming speech recognition results for Python. (#2196)] <a href=https://github.com/k2-fsa/sherpa-onnx/commit/4a833a754743076d68252731c681511e2d9390bd>https://github.com/k2-fsa/sherpa-onnx/commit/4a833a754743076d68252731c681511e2d9390bd</a></li></ul><p>å¦å¤–ä¹Ÿä½“éªŒåˆ° two-pass åŒæ¨¡å‹è¯†åˆ«çš„æ•ˆæœï¼Œä¸¤ç§æ–¹å¼éƒ½èƒ½æ»¡è¶³ä¿ºçš„ä½¿ç”¨åœºæ™¯ğŸ‰</p><ul><li>[Two-pass real-time speech recognition from a microphone with sherpa-onnx] <a href=https://github.com/k2-fsa/sherpa-onnx/blob/b269e5cccc03c3e61dd9f363bb7b64b5b0ce6c3a/python-api-examples/two-pass-speech-recognition-from-microphone.py>https://github.com/k2-fsa/sherpa-onnx/blob/b269e5cccc03c3e61dd9f363bb7b64b5b0ce6c3a/python-api-examples/two-pass-speech-recognition-from-microphone.py</a></li></ul><p>åœ¨å¤§ä½¬çš„åŸºç¡€ç¤ºä¾‹ä¸Šï¼Œç®€å•è¡¥å……ç‚¹å†…å®¹çš„ä¿å­˜</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>          result = result.lower().strip()
</span></span><span style=display:flex><span>          display.update_text(result)
</span></span><span style=display:flex><span><span style=color:#a6e22e>+          log(result)
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>          display.finalize_current_sentence()
</span></span><span style=display:flex><span>          display.display()
</span></span><span style=display:flex><span>        else:
</span></span><span style=display:flex><span>          sample_buffers = []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        first_recognizer.reset(stream)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>+ def log(result):
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+   global file_handler
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+   file_handler.write(f&#34;{datetime.now().strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)} - {result}\n&#34;)
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+   file_handler.flush()
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>if __name__ == &#34;__main__&#34;:
</span></span><span style=display:flex><span><span style=color:#a6e22e>+  from datetime import datetime
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+  ts = datetime.now().strftime(&#34;%y%m%d%H%M%S&#34;)
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+  file_path = Path(f&#34;~/Desktop/asr/2pass.{ts}.txt&#34;).expanduser()
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+  file_handler = open(file_path, &#34;a&#34;)
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>  try:
</span></span><span style=display:flex><span>    main()
</span></span><span style=display:flex><span>  except KeyboardInterrupt:
</span></span><span style=display:flex><span>    print(&#34;\nCaught Ctrl + C. Exiting&#34;)
</span></span><span style=display:flex><span><span style=color:#a6e22e>+  finally:
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+    file_handler.close()
</span></span></span></code></pre></div></main><footer><p>Copyright 2025. All rights reserved.</p></footer></body></html>